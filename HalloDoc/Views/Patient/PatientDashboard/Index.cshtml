@using static HalloDoc.Entity.Models.Constant;
@model HalloDoc.Entity.Models.PatientModels.PatientDashList;
@{
    Layout = "_LayoutPatient";
}
 <partial name="../Patient/PatientDashboard/CreateNewRequest" /> 


<div class="justify-content-between d-flex mt-5 position-relative ">
    <div class="">
        <h4 class="fw-bolder">
            Medical History
        </h4>
    </div>
</div>
<div class="border-0 shadow pt-4 mb-5 mt-3 rounded">
    <div class="d-flex justify-content-end mx-2 px-3">
        <!-- Button trigger modal -->
        <a class="text-decoration-none" data-bs-toggle="modal" data-bs-target="#requestBackdrop"><i class="d-block d-sm-none fa fa-solid fa-plus text-info border rounded border-info my-3 p-2"></i></a>
        <button type="button" class="btn btn-outline-info d-none d-sm-block " data-bs-toggle="modal" data-bs-target="#requestBackdrop">
            Create New Request
        </button>
    </div>
    <div>
        <div class="d-none d-sm-block">
            <table class="table table-responsive mt-3 mb-0 dataTable">
                <thead class="theadbg">
                    <tr>
                        @{
                            var J1 = @Model.IsAscending;
                            <th scope="col" width="30%" style="position:relative;" class="dt-orderable-asc dt-orderable-desc @(J1 == true ?"dt-ordering-asc" : "dt-ordering-desc" )" onclick="SetColumValue('createdDate')">
                                Created Date
                                <span class="dt-column-order"></span>
                            </th>
                            <th scope="col" width="55%">Current Status</th>
                            <th scope="col">Document</th>
                            }
                    </tr>
                </thead>
                <tbody class="table-group-divider">
                    @foreach (var item in Model.patientdata)
                    {
                        <tr>
                            <td scope="row"> @item.createdDate.ToString("MMM d , yyyy")</td>
                            <td>@Enum.GetName(typeof(Status), item.Status)</td>
                            <td>
                                @{
                                    if (item.DocumentCount > 0)
                                    {
                                        <a asp-action="ViewUploads" asp-controller="PatientDashboard" asp-route-id="@item.RequestId" class="btn btn-outline-info btn-sm document-button">
                                            Document(@item.DocumentCount)
                                        </a>
                                    }
                                }
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <!--Mobile screen view-->
        <div class="d-block d-sm-none">
            <div class="accordion" id="accordionFlushExample">
                @foreach (var item in Model.patientdata)
                {
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="flush-heading-@item.RequestId">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-@item.RequestId" aria-expanded="false" aria-controls="flush-collapseOne">
                                <i class="fa-solid fa-clock pe-2 text-info"></i>
                                <strong>Created Date : </strong>
                                @item.createdDate.ToString("MMM d, yyyy")
                            </button>
                        </h2>
                        <div id="flush-@item.RequestId" class="accordion-collapse collapse" aria-labelledby="flush-heading-@item.RequestId" data-bs-parent="#accordionFlushExample">
                            <div class="accordion-body">
                                <div class="mb-3">
                                    <i class="fa-solid fa-user text-info border border-info rounded-circle p-2"></i>
                                    <strong class="px-1">Provider : </strong>
                                </div>
                                <div class="mb-3">
                                    <i class="fa-solid fa-check text-info border border-info rounded-circle p-2"></i>
                                    <strong class="px-1">Current Status : </strong>
                                    @Enum.GetName(typeof(Status), item.Status)
                                </div>
                                <div>
                                    @{
                                        if (item.DocumentCount > 0)
                                        {
                                            <div asp-action="DocumentInfo" asp-controller="Dashboard" asp-route-id="@item.RequestId" class="btn btn-outline-info btn-sm document-button shadow-none col-12">
                                                (@item.DocumentCount)Document
                                            </div>
                                        }
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
            
        </div>
        <!--End Mobile screen view-->

	</div>
</div>
<div class="d-flex justify-content-between">
	<form id="documentformPagesize" asp-action="Index" asp-controller="PatientDashboard" asp-route-id="" novalidate="novalidate" class="d-flex">
		<div class="search m-1 d-flex justify-content-between">
			<input type="hidden" value="@Model.UserId" asp-for="UserId" />
			<span class="pagesize">Page Size</span>
			<select class="form-select pagesizeselect" asp-for="PageSize" data-allow-clear="true" tabindex="-1" id="pagesizedropdowndocument" data-control="select2" data-placeholder="Select Level">
				<option value="5" selected>5</option>
				<option value="10">10</option>
				<option value="20">20</option>
				<option value="50">50</option>
			</select>
		</div>
	</form>
	<nav aria-label="Page navigation example">
		<ul class="pagination pagination-container">
			@{
				int i;
				<form id="dataformpatient"
					  asp-action="Index" asp-controller="PatientDashboard" asp-route-id="" novalidate="novalidate" class="d-flex">
					<input type="hidden" value="@Model.UserId" asp-for="UserId" />
					<input type="hidden" asp-for="CurrentPage" id="currentpagevaluedocumentpatient" />
					<input type="hidden" asp-for="IsAscending" />
					<input type="hidden" asp-for="PageSize" />
					@if (@Model.CurrentPage > 1)
					{
					<li class="page-item me-2"><button class="btn shadow-none" onclick="setpagenumber('previous')">&lt;</button></li>
					}
					else
					{
					<li class="me-2 page-item"><a class="disabled btn">&lt;</a></li>
					}
					@for (i = 1; i <= @Model.TotalPages; i++)
					{
					<li class="page-item me-2"><button class="@(i == @Model.CurrentPage ? "activepagebtn" : "") btn shadow-none" onclick="setpagenumber(@i)">@i</button></li>
					}
					@if (@Model.TotalPages > @Model.CurrentPage)
					{
					<li class="page-item me-2"><button class="btn shadow-none" onclick="setpagenumber('next')">&gt;</button></li>
					}
					else
					{
					<li class="me-2 page-item"><a class="btn disabled">&gt;</a></li>
					}
				</form>
			}
		</ul>
	</nav>
</div>
<form class="sortingformpatient" asp-action="Index" asp-controller="PatientDashboard" novalidate="novalidate">
    <input type="hidden" asp-for="IsAscending" id="isAsccol" />
    <input type="hidden" value="@Model.UserId" asp-for="UserId" />
    <input type="hidden" asp-for="PageSize" />
</form>
<script src="~/js/site.js"></script>
<script>
    function setpagenumber(e) {
        console.log(e)
        if (e == 'previous') {
            var cp = @Model.CurrentPage-1;
            $('#currentpagevaluedocumentpatient').val(cp);
        }
        else if (e == 'next') {
            var cp = @Model.CurrentPage + 1;
            $('#currentpagevaluedocumentpatient').val(cp);
        }
        else {
            $('#currentpagevaluedocumentpatient').val(e);
        }
        $("#dataformpatient").submit();
    }
    function SetColumValue(e) {
        console.log(e)
        var modeldata = @Html.Raw(Json.Serialize(Model));
        if (modeldata.isAscending == true) {
            document.getElementById('isAsccol').value = false;
        }
        else {
            document.getElementById('isAsccol').value = true;
        }
        $(".sortingformpatient").submit();
    }
    $('#pagesizedropdowndocument').on('change', function () {
        console.log("abc");
        $('#documentformPagesize').submit();
    });
</script>